# å“ç‰Œæ•°æ®åº“åˆå¹¶è¿ç§»ç³»ç»Ÿ

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªç”¨äºå°†å“ç‰ŒAæ•°æ®åº“è¿ç§»åˆ°å“ç‰ŒBæ•°æ®åº“çš„æ•°æ®è¿ç§»ç³»ç»Ÿã€‚æ”¯æŒåˆ†æ‰¹æ¬¡è¿ç§»ã€äº‹åŠ¡ç®¡ç†ã€æ•°æ®éªŒè¯å’Œè‡ªåŠ¨å›æ»šã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- âœ… **åŒæ•°æ®æºé…ç½®**: æºæ•°æ®åº“ï¼ˆåªè¯»ï¼‰å’Œç›®æ ‡æ•°æ®åº“ï¼ˆè¯»å†™ï¼‰
- âœ… **åˆ†æ‰¹æ¬¡è¿ç§»**: æ”¯æŒè‡ªå®šä¹‰æ‰¹æ¬¡å¤§å°ï¼Œé¿å…å†…å­˜æº¢å‡º
- âœ… **äº‹åŠ¡ç®¡ç†**: äº‹åŠ¡åªåŒ…è£¹å†™å…¥å’ŒéªŒè¯æ“ä½œï¼Œæ‰¹æ¬¡çº§åˆ«å›æ»š
- âœ… **æ•°æ®éªŒè¯**: æ¯æ‰¹æ¬¡æ’å…¥åéªŒè¯æ•°é‡ï¼Œä¸åŒ¹é…è‡ªåŠ¨å›æ»š
- âœ… **æ˜ å°„ç®¡ç†**: ç»´æŠ¤æ–°æ—§IDæ˜ å°„å…³ç³»ï¼Œæ”¯æŒå¯¼å‡ºå’Œæ ¡éªŒ
- âœ… **å­—æ®µå…¼å®¹**: å¤„ç†å­—æ®µåå¤§å°å†™ä¸ä¸€è‡´é—®é¢˜
- âœ… **ç‹¬ç«‹æ¥å£**: æ¯ä¸ªè¡¨ç‹¬ç«‹çš„è¿ç§»æ¥å£
- âœ… **æ•°æ®æ ¡éªŒ**: userPhoneMappingç”¨äºè¿ç§»åæ•°æ®å¯¹æ¯”

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

- **Spring Boot**: 3.3.11
- **MyBatis-Plus**: 3.5.12
- **Java**: 17
- **æ•°æ®åº“**: MySQL

## ğŸ“ é¡¹ç›®ç»“æ„

```
webapp/
â”œâ”€â”€ common/src/main/java/com/mos/base/common/
â”‚   â”œâ”€â”€ config/                      # é…ç½®ç±»ï¼ˆåŒæ•°æ®æºï¼‰
â”‚   â”œâ”€â”€ entity/                      # å®ä½“ç±»ï¼ˆ7ä¸ªè¡¨ï¼‰
â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”œâ”€â”€ source/                  # æºæ•°æ®åº“Mapperï¼ˆåªè¯»ï¼‰
â”‚   â”‚   â””â”€â”€ target/                  # ç›®æ ‡æ•°æ®åº“Mapperï¼ˆè¯»å†™ï¼‰
â”‚   â”œâ”€â”€ service/impl/                # è¿ç§»æœåŠ¡ï¼ˆ6ä¸ªï¼‰
â”‚   â”œâ”€â”€ controller/                  # è¿ç§»æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ dto/                         # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â””â”€â”€ cache/                       # æ˜ å°„ç¼“å­˜ç®¡ç†
â”œâ”€â”€ MIGRATION_GUIDE.md               # è¯¦ç»†ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ PROJECT_SUMMARY.md               # é¡¹ç›®å¼€å‘æ€»ç»“
â”œâ”€â”€ migration-example.sh             # è‡ªåŠ¨åŒ–è¿ç§»è„šæœ¬
â””â”€â”€ README.md                        # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®æ•°æ®åº“

ç¼–è¾‘ `common/src/main/resources/application.yml`:

```yaml
spring:
  datasource:
    source:
      jdbc-url: jdbc:mysql://YOUR_HOST:3306/brand_a?useUnicode=true&characterEncoding=utf8
      username: YOUR_USERNAME
      password: YOUR_PASSWORD
    target:
      jdbc-url: jdbc:mysql://YOUR_HOST:3306/brand_b?useUnicode=true&characterEncoding=utf8
      username: YOUR_USERNAME
      password: YOUR_PASSWORD
```

### 2. å¯åŠ¨æœåŠ¡

```bash
./mvnw spring-boot:run
```

æœåŠ¡å°†åœ¨ `http://localhost:9000/base` å¯åŠ¨ã€‚

### 3. æ‰§è¡Œè¿ç§»

**æ–¹å¼1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬**

```bash
./migration-example.sh
```

**æ–¹å¼2: æ‰‹åŠ¨è°ƒç”¨API**

å‚è€ƒ [MIGRATION_GUIDE.md](MIGRATION_GUIDE.md) ä¸­çš„è¯¦ç»†æ­¥éª¤ã€‚

## ğŸ“Š è¿ç§»é¡ºåº

```
1. åˆå§‹åŒ–Accountæ˜ å°„ (æ‰‹åŠ¨æä¾›)
   â†“
2. Userè¡¨è¿ç§»
   â†“
3. UserToAgentè¡¨è¿ç§»
   â†“
4. RideCardè¡¨è¿ç§»
   â†“
5. RideCardUserè¡¨è¿ç§»
   â†“
6. GiftCardè¡¨è¿ç§»
   â†“
7. GiftCardUserè¡¨è¿ç§»
```

âš ï¸ **å¿…é¡»ä¸¥æ ¼æŒ‰æ­¤é¡ºåºæ‰§è¡Œï¼**

## ğŸ”Œ APIæ¥å£

### è¿ç§»æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/migration/init-account-mapping` | POST | åˆå§‹åŒ–Accountæ˜ å°„ |
| `/migration/user` | POST | è¿ç§»Userè¡¨ |
| `/migration/usertoagent` | POST | è¿ç§»UserToAgentè¡¨ |
| `/migration/ridecard` | POST | è¿ç§»RideCardè¡¨ |
| `/migration/ridecarduser` | POST | è¿ç§»RideCardUserè¡¨ |
| `/migration/giftcard` | POST | è¿ç§»GiftCardè¡¨ |
| `/migration/giftcarduser` | POST | è¿ç§»GiftCardUserè¡¨ |

### æŸ¥è¯¢æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/migration/mappings/{type}` | GET | æŸ¥è¯¢æ˜ å°„å…³ç³» |
| `/migration/validate-user-phone` | GET | è·å–ç”¨æˆ·æ‰‹æœºå·æ˜ å°„ |
| `/migration/clear-all-mappings` | POST | æ¸…ç©ºæ‰€æœ‰æ˜ å°„ |

## ğŸ“– è¯¦ç»†æ–‡æ¡£

- **[MIGRATION_GUIDE.md](MIGRATION_GUIDE.md)**: å®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’ŒAPIæ–‡æ¡£
- **[PROJECT_SUMMARY.md](PROJECT_SUMMARY.md)**: é¡¹ç›®å¼€å‘æ€»ç»“å’ŒæŠ€æœ¯ç»†èŠ‚

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- **åªè¯»æºæ•°æ®åº“**: æºæ•°æ®åº“é…ç½®ä¸ºåªè¯»ï¼Œé˜²æ­¢è¯¯æ“ä½œ
- **äº‹åŠ¡å›æ»š**: éªŒè¯å¤±è´¥è‡ªåŠ¨å›æ»šå½“å‰æ‰¹æ¬¡
- **æ‰¹æ¬¡éš”ç¦»**: æ¯ä¸ªæ‰¹æ¬¡ç‹¬ç«‹äº‹åŠ¡ï¼Œå¤±è´¥ä¸å½±å“å·²å®Œæˆçš„æ‰¹æ¬¡
- **æ•°æ®éªŒè¯**: å¤šå±‚éªŒè¯ç¡®ä¿æ•°æ®å®Œæ•´æ€§

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è¿ç§»å‰**:
   - âœ… å¤‡ä»½å“ç‰ŒBæ•°æ®åº“
   - âœ… åœ¨å“ç‰ŒBä¸­é¢„åˆ›å»ºaccount
   - âœ… å‡†å¤‡accountIdæ˜ å°„å…³ç³»

2. **è¿ç§»ä¸­**:
   - âœ… ä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œ
   - âœ… æ¯æ­¥æ£€æŸ¥å“åº”
   - âœ… å‡ºé”™ç«‹å³åœæ­¢

3. **è¿ç§»å**:
   - âœ… å¯¹æ¯”æ•°æ®é‡
   - âœ… ä½¿ç”¨validate-user-phoneæ ¡éªŒ
   - âœ… æŠ½æŸ¥æ•°æ®æ­£ç¡®æ€§

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. åˆå§‹åŒ–Accountæ˜ å°„

```bash
curl -X POST http://localhost:9000/base/migration/init-account-mapping \
  -H "Content-Type: application/json" \
  -d '{
    "accountMapping": {
      "1": 101,
      "2": 102
    }
  }'
```

### 2. è¿ç§»Userè¡¨

```bash
curl -X POST http://localhost:9000/base/migration/user \
  -H "Content-Type: application/json" \
  -d '{"batchSize": 1000}'
```

### 3. æŸ¥è¯¢æ˜ å°„å…³ç³»

```bash
curl http://localhost:9000/base/migration/mappings/user
```

### 4. æ•°æ®æ ¡éªŒ

```bash
curl http://localhost:9000/base/migration/validate-user-phone
```

## ğŸ¯ æ¶‰åŠçš„æ•°æ®è¡¨

| è¡¨å | è¯´æ˜ | ä¾èµ–å…³ç³» |
|------|------|----------|
| account | ç®¡ç†è´¦æˆ· | æ‰‹åŠ¨åˆå§‹åŒ–æ˜ å°„ |
| user | ä¸€çº¿ç”¨æˆ· | accountMapping |
| usertoagent | ç”¨æˆ·åŒºåŸŸå…³è” | accountMapping, userMapping |
| ridecard | éª‘è¡Œå¡ | accountMapping |
| ridecarduser | éª‘è¡Œå¡ç”¨æˆ·å…³è” | accountMapping, userMapping, rideCardMapping |
| giftcard | ç¤¼å“å¡ | accountMapping |
| giftcarduser | ç¤¼å“å¡ç”¨æˆ·ä½™é¢ | accountMapping, userMapping, giftCardMapping |

## ğŸ”§ æ•…éšœæ’æŸ¥

### Q: æ‰¾ä¸åˆ°æ˜ å°„å…³ç³»ï¼Ÿ
**A**: æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–accountMappingæˆ–å‰ç½®è¡¨å·²è¿ç§»ã€‚

### Q: æ’å…¥æ•°é‡ä¸åŒ¹é…ï¼Ÿ
**A**: äº‹åŠ¡ä¼šè‡ªåŠ¨å›æ»šï¼Œæ£€æŸ¥æ•°æ®åº“çº¦æŸæˆ–å”¯ä¸€é”®å†²çªã€‚

### Q: è¿ç§»ä¸­æ–­æ€ä¹ˆåŠï¼Ÿ
**A**: 
1. æŸ¥è¯¢æ˜ å°„å…³ç³»ç¡®è®¤å·²è¿ç§»æ•°æ®
2. æ¸…ç©ºæ˜ å°„ç¼“å­˜é‡æ–°å¼€å§‹
3. æˆ–è°ƒæ•´æ‰¹æ¬¡å¤§å°ç»§ç»­è¿ç§»

### Q: å¦‚ä½•é‡æ–°è¿ç§»æŸä¸ªè¡¨ï¼Ÿ
**A**:
1. æ‰‹åŠ¨æ¸…ç©ºç›®æ ‡æ•°æ®åº“è¯¥è¡¨æ•°æ®
2. æ¸…é™¤å¯¹åº”çš„æ˜ å°„ç¼“å­˜
3. é‡æ–°è°ƒç”¨è¿ç§»æ¥å£

## ğŸ“œ Gitæäº¤è®°å½•

```bash
git log --oneline
# 42e8603 docs: æ·»åŠ è¿ç§»ç¤ºä¾‹è„šæœ¬
# ed59a20 feat: å®ç°å“ç‰Œæ•°æ®åº“åˆå¹¶è¿ç§»ç³»ç»Ÿ
```

## ğŸ‘¨â€ğŸ’» å¼€å‘ä¿¡æ¯

- **å¼€å‘æ—¶é—´**: 2025-11-18
- **æ–‡ä»¶æ•°é‡**: 37ä¸ªJavaæ–‡ä»¶ + é…ç½®æ–‡ä»¶ + æ–‡æ¡£
- **ä»£ç è¡Œæ•°**: çº¦2500è¡Œ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å†…éƒ¨ä½¿ç”¨ã€‚

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦æ”¯æŒï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

**é‡è¦æé†’**: è¿ç§»å‰åŠ¡å¿…å¤‡ä»½æ•°æ®åº“ï¼ä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œè¿ç§»æ­¥éª¤ï¼
